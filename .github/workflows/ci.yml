# .github/workflows/deploy-netlify.yml
name: Deploy to Netlify

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      # Detect and build your project
      - name: Build project
        run: |
          echo "üîç Detecting project type..."
          
          # If it's a Node.js project
          if [ -f "package.json" ]; then
            echo "üì¶ Node.js project detected"
            npm ci
            
            # Check for build script
            if grep -q '"build"' package.json; then
              echo "üèóÔ∏è Running npm run build"
              npm run build
              echo "‚úÖ Build completed"
            else
              echo "‚ö†Ô∏è No build script found, creating default dist folder"
              mkdir -p dist
              # Copy common web files
              cp -r *.html *.css *.js public/ dist/ 2>/dev/null || true
            fi
          
          # If it's a Python/Flask/Django project
          elif [ -f "requirements.txt" ]; then
            echo "üêç Python project detected"
            echo "‚ö†Ô∏è For Python backends, use 'netlify functions' or separate backend hosting"
            mkdir -p dist
            echo "<h1>Python Backend - Deploy API separately</h1>" > dist/index.html
          
          # If it's a static site
          else
            echo "üìÑ Static HTML project detected"
            mkdir -p dist
            # Copy all web files
            cp -r *.html *.css *.js images/ css/ js/ dist/ 2>/dev/null || true
            # If no index.html, create one
            if [ ! -f "dist/index.html" ]; then
              echo "<h1>HyVoice-Repo</h1><p>Deployed via Netlify</p>" > dist/index.html
            fi
          fi
          
          echo "üìÅ Build output in 'dist/' folder"
          ls -la dist/ 2>/dev/null || echo "No dist folder created"
      
      # Deploy to Netlify
      - name: Deploy to Netlify
        uses: nwtgck/actions-netlify@v3.0
        with:
          publish-dir: './dist'
          production-branch: main
          github-token: ${{ secrets.GITHUB_TOKEN }}
          deploy-message: "Deploy from GitHub Actions"
          enable-pull-request-comment: true
          enable-commit-comment: true
          overwrites-pull-request-comment: true
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
        timeout-minutes: 1
